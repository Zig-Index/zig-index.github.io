---
import Layout from "../layouts/Layout.astro";
import { HowToAddPage } from "../components/HowToAddPage";
import { loadRegistryData } from "../lib/registryLoader";
import type { SearchItem } from "../lib/schemas";

// Load registry data for search functionality
const allEntries = await loadRegistryData();

// Prepare search items for navbar
const searchItems = allEntries.map(e => ({
  name: e.name,
  owner: e.owner,
  repo: e.repo,
  description: e.description,
  category: e.category,
  type: e.type,
  fullName: `${e.owner}/${e.repo}`,
})) as SearchItem[];

const siteUrl = import.meta.env.PUBLIC_SITE_URL || "https://zig-index.github.io";
const siteName = import.meta.env.PUBLIC_SITE_NAME || "Zig Index";

const schema = {
  "@context": "https://schema.org",
  "@type": "HowTo",
  "name": `How to Add Your Zig Project to ${siteName}`,
  "description": `Learn how to submit your Zig package or application to the ${siteName} registry via Pull Request.`,
  "url": `${siteUrl}/how-to-add`,
  "step": [
    {
      "@type": "HowToStep",
      "position": 1,
      "name": "Fork the Registry Repository",
      "text": `Fork the ${siteName} registry repository on GitHub to get started.`
    },
    {
      "@type": "HowToStep",
      "position": 2,
      "name": "Create JSON Entry",
      "text": "Add a new JSON file in database/username/ with your project details."
    },
    {
      "@type": "HowToStep",
      "position": 3,
      "name": "Submit Pull Request",
      "text": "Submit a Pull Request with your changes for review."
    }
  ]
};
---

<Layout 
  title={`How to Add Your Zig Project | ${siteName}`}
  description={`Learn how to add your Zig package or application to ${siteName}. Simple Pull Request process to get your project listed in the community registry.`}
  keywords="add zig package, submit zig project, zig registry contribution, zig community, open source zig, zig index"
  canonicalUrl={`${siteUrl}/how-to-add`}
  schema={schema}
>
  <HowToAddPage client:load searchItems={searchItems} />
</Layout>
