---
import Layout from "../layouts/Layout.astro";
import { HomePage } from "../components/HomePage";
import { loadRegistryData, getRegistryStats } from "../lib/registryLoader";

// Load all registry data at build time
const allEntries = await loadRegistryData();
const stats = getRegistryStats(allEntries);

const siteUrl = import.meta.env.PUBLIC_SITE_URL || "https://zig-index.github.io";
const siteName = import.meta.env.PUBLIC_SITE_NAME || "Zig Index";

// FAQ items for SEO
const faqItems = [
  {
    question: `What is ${siteName}?`,
    answer: `${siteName} is an independent, community-driven index for discovering Zig packages, libraries, and applications. It is not affiliated with, endorsed by, or maintained by the Zig Software Foundation. It helps developers find quality tools and modules for the Zig programming language ecosystem.`
  },
  {
    question: `How do I add my Zig project to ${siteName}?`,
    answer: "You can add your project by submitting a Pull Request to our GitHub registry repository. Create a JSON file with your project details in the registry folder and submit it for review."
  },
  {
    question: `Is ${siteName} free to use?`,
    answer: `Yes, ${siteName} is completely free and open source. All data is fetched from GitHub and displayed client-side for fast, privacy-respecting browsing.`
  },
  {
    question: "What types of projects are listed?",
    answer: "Projects include reusable libraries, modules, and standalone applications built with Zig."
  },
  {
    question: "How often is the registry updated?",
    answer: "The registry is updated through community contributions via Pull Requests. Live statistics like stars and forks are fetched directly from GitHub when you browse the site."
  },
  {
    question: `Can I contribute to ${siteName}?`,
    answer: `Absolutely! ${siteName} is open source. You can contribute by adding packages, reporting issues, or improving the website code on our GitHub repository.`
  }
];

const schema = {
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "WebSite",
      "name": siteName,
      "url": siteUrl,
      "description": "An unofficial, community-driven index for discovering Zig packages, libraries, and applications. Not affiliated with the Zig Software Foundation.",
      "potentialAction": {
        "@type": "SearchAction",
        "target": `${siteUrl}/search?q={search_term_string}`,
        "query-input": "required name=search_term_string"
      },
      "publisher": {
        "@type": "Organization",
        "name": "Zig Index",
        "url": siteUrl
      }
    },
    {
      "@type": "FAQPage",
      "mainEntity": faqItems.map(item => ({
        "@type": "Question",
        "name": item.question,
        "acceptedAnswer": {
          "@type": "Answer",
          "text": item.answer
        }
      }))
    },
    {
      "@type": "SoftwareApplication",
      "name": "Zig Index",
      "applicationCategory": "DeveloperApplication",
      "operatingSystem": "Web",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "5",
        "ratingCount": stats.totalEntries.toString()
      }
    }
  ]
};
---

<Layout 
  title={`${siteName} | Discover Zig Packages & Applications`}
  description="The unofficial, community-driven registry for Zig. Discover, search, and explore high-quality Zig packages, libraries, and applications. Not affiliated with the Zig Software Foundation."
  keywords="zig packages, zig registry, zig applications, zig libraries, zig modules, zig language, zig ecosystem, zig index"
  canonicalUrl={siteUrl}
  schema={schema}
>
  <HomePage 
    client:load 
    registryEntries={allEntries}
  />
</Layout>
